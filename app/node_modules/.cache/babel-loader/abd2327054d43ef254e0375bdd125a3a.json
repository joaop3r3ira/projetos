{"ast":null,"code":"var __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n\n  return ar;\n};\n\nimport { MagicOutgoingWindowMessage, MagicIncomingWindowMessage } from '@magic-sdk/types';\nimport { createMalformedResponseError, MagicRPCError } from '../core/sdk-exceptions';\nimport { standardizeJsonRpcRequestPayload } from '../core/json-rpc';\nimport { createPromiEvent } from '../util/promise-tools';\n\nvar BaseModule =\n/** @class */\nfunction () {\n  function BaseModule(sdk) {\n    this.sdk = sdk;\n  }\n\n  Object.defineProperty(BaseModule.prototype, \"transport\", {\n    /**\n     * The `PayloadTransport` for the SDK instance registered to this module.\n     */\n    get: function () {\n      return this.sdk.transport;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(BaseModule.prototype, \"overlay\", {\n    /**\n     * The `ViewController` for the SDK instance registered to this module.\n     */\n    get: function () {\n      return this.sdk.overlay;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\n   * Emits promisified requests to the Magic `<iframe>` context.\n   */\n\n  BaseModule.prototype.request = function (payload) {\n    var responsePromise = this.transport.post(this.overlay, MagicOutgoingWindowMessage.MAGIC_HANDLE_REQUEST, standardizeJsonRpcRequestPayload(payload)); // PromiEvent-ify the response.\n\n    var promiEvent = createPromiEvent(function (resolve, reject) {\n      responsePromise.then(function (res) {\n        cleanupEvents();\n        if (res.hasError) reject(new MagicRPCError(res.payload.error));else if (res.hasResult) resolve(res.payload.result);else throw createMalformedResponseError();\n      }).catch(function (err) {\n        cleanupEvents();\n        reject(err);\n      });\n    }); // Listen for events from the `<iframe>` associated with the current payload\n    // and emit those to `PromiEvent` subscribers.\n\n    var cleanupEvents = this.transport.on(MagicIncomingWindowMessage.MAGIC_HANDLE_EVENT, function (evt) {\n      var _a;\n\n      var response = evt.data.response;\n\n      if (response.id === payload.id && ((_a = response.result) === null || _a === void 0 ? void 0 : _a.event)) {\n        var _b = response.result,\n            event_1 = _b.event,\n            _c = _b.params,\n            params = _c === void 0 ? [] : _c;\n        promiEvent.emit.apply(promiEvent, __spread([event_1], params));\n      }\n    });\n    return promiEvent;\n  };\n\n  return BaseModule;\n}();\n\nexport { BaseModule };","map":{"version":3,"sources":["../../../src/modules/base-module.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAAgC,0BAAhC,EAA4D,0BAA5D,QAA8F,kBAA9F;AACA,SAAS,4BAAT,EAAuC,aAAvC,QAA4D,wBAA5D;AAGA,SAAS,gCAAT,QAAiD,kBAAjD;AACA,SAAS,gBAAT,QAAiC,uBAAjC;;AAIA,IAAA,UAAA;AAAA;AAAA,YAAA;EACE,SAAA,UAAA,CAA+B,GAA/B,EAA2C;IAAZ,KAAA,GAAA,GAAA,GAAA;EAAgB;;EAK/C,MAAA,CAAA,cAAA,CAAc,UAAA,CAAA,SAAd,EAAc,WAAd,EAAuB;IAHvB;;AAEG;SACH,YAAA;MACE,OAAQ,KAAK,GAAL,CAAiB,SAAzB;IACD,CAFsB;oBAAA;;EAAA,CAAvB;EAOA,MAAA,CAAA,cAAA,CAAc,UAAA,CAAA,SAAd,EAAc,SAAd,EAAqB;IAHrB;;AAEG;SACH,YAAA;MACE,OAAQ,KAAK,GAAL,CAAiB,OAAzB;IACD,CAFoB;oBAAA;;EAAA,CAArB;EAIA;;AAEG;;EACO,UAAA,CAAA,SAAA,CAAA,OAAA,GAAV,UAA4E,OAA5E,EAAmH;IACjH,IAAM,eAAe,GAAG,KAAK,SAAL,CAAe,IAAf,CACtB,KAAK,OADiB,EAEtB,0BAA0B,CAAC,oBAFL,EAGtB,gCAAgC,CAAC,OAAD,CAHV,CAAxB,CADiH,CAOjH;;IACA,IAAM,UAAU,GAAG,gBAAgB,CAAqB,UAAC,OAAD,EAAU,MAAV,EAAgB;MACtE,eAAe,CACZ,IADH,CACQ,UAAC,GAAD,EAAI;QACR,aAAa;QACb,IAAI,GAAG,CAAC,QAAR,EAAkB,MAAM,CAAC,IAAI,aAAJ,CAAkB,GAAG,CAAC,OAAJ,CAAY,KAA9B,CAAD,CAAN,CAAlB,KACK,IAAI,GAAG,CAAC,SAAR,EAAmB,OAAO,CAAC,GAAG,CAAC,OAAJ,CAAY,MAAb,CAAP,CAAnB,KACA,MAAM,4BAA4B,EAAlC;MACN,CANH,EAOG,KAPH,CAOS,UAAC,GAAD,EAAI;QACT,aAAa;QACb,MAAM,CAAC,GAAD,CAAN;MACD,CAVH;IAWD,CAZkC,CAAnC,CARiH,CAsBjH;IACA;;IACA,IAAM,aAAa,GAAG,KAAK,SAAL,CAAe,EAAf,CAAkB,0BAA0B,CAAC,kBAA7C,EAAiE,UAAC,GAAD,EAAI;;;MACjF,IAAA,QAAA,GAAA,GAAA,CAAA,IAAA,CAAA,QAAA;;MACR,IAAI,QAAQ,CAAC,EAAT,KAAgB,OAAO,CAAC,EAAxB,KAA0B,CAAA,EAAA,GAAI,QAAQ,CAAC,MAAb,MAAmB,IAAnB,IAAmB,EAAA,KAAA,KAAA,CAAnB,GAAmB,KAAA,CAAnB,GAAmB,EAAA,CAAE,KAA/C,CAAJ,EAA0D;QAClD,IAAA,EAAA,GAAA,QAAA,CAAA,MAAA;QAAA,IAAE,OAAA,GAAA,EAAA,CAAA,KAAF;QAAA,IAAS,EAAA,GAAA,EAAA,CAAA,MAAT;QAAA,IAAS,MAAA,GAAA,EAAA,KAAA,KAAA,CAAA,GAAA,EAAA,GAAA,EAAT;QACN,UAAU,CAAC,IAAX,CAAe,KAAf,CAAA,UAAA,EAAU,QAAA,CAAA,CAAM,OAAN,CAAA,EAAgB,MAAhB,CAAV;MACD;IACF,CANqB,CAAtB;IAQA,OAAO,UAAP;EACD,CAjCS;;EAkCZ,OAAA,UAAA;AAAC,CAtDD,EAAA","sourceRoot":"","sourcesContent":["var __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spread = (this && this.__spread) || function () {\n    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n    return ar;\n};\nimport { MagicOutgoingWindowMessage, MagicIncomingWindowMessage } from '@magic-sdk/types';\nimport { createMalformedResponseError, MagicRPCError } from '../core/sdk-exceptions';\nimport { standardizeJsonRpcRequestPayload } from '../core/json-rpc';\nimport { createPromiEvent } from '../util/promise-tools';\nvar BaseModule = /** @class */ (function () {\n    function BaseModule(sdk) {\n        this.sdk = sdk;\n    }\n    Object.defineProperty(BaseModule.prototype, \"transport\", {\n        /**\n         * The `PayloadTransport` for the SDK instance registered to this module.\n         */\n        get: function () {\n            return this.sdk.transport;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(BaseModule.prototype, \"overlay\", {\n        /**\n         * The `ViewController` for the SDK instance registered to this module.\n         */\n        get: function () {\n            return this.sdk.overlay;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * Emits promisified requests to the Magic `<iframe>` context.\n     */\n    BaseModule.prototype.request = function (payload) {\n        var responsePromise = this.transport.post(this.overlay, MagicOutgoingWindowMessage.MAGIC_HANDLE_REQUEST, standardizeJsonRpcRequestPayload(payload));\n        // PromiEvent-ify the response.\n        var promiEvent = createPromiEvent(function (resolve, reject) {\n            responsePromise\n                .then(function (res) {\n                cleanupEvents();\n                if (res.hasError)\n                    reject(new MagicRPCError(res.payload.error));\n                else if (res.hasResult)\n                    resolve(res.payload.result);\n                else\n                    throw createMalformedResponseError();\n            })\n                .catch(function (err) {\n                cleanupEvents();\n                reject(err);\n            });\n        });\n        // Listen for events from the `<iframe>` associated with the current payload\n        // and emit those to `PromiEvent` subscribers.\n        var cleanupEvents = this.transport.on(MagicIncomingWindowMessage.MAGIC_HANDLE_EVENT, function (evt) {\n            var _a;\n            var response = evt.data.response;\n            if (response.id === payload.id && ((_a = response.result) === null || _a === void 0 ? void 0 : _a.event)) {\n                var _b = response.result, event_1 = _b.event, _c = _b.params, params = _c === void 0 ? [] : _c;\n                promiEvent.emit.apply(promiEvent, __spread([event_1], params));\n            }\n        });\n        return promiEvent;\n    };\n    return BaseModule;\n}());\nexport { BaseModule };\n//# sourceMappingURL=base-module.js.map"]},"metadata":{},"sourceType":"module"}